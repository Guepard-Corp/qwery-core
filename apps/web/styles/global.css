/*
* global.css
*
* Global styles for the entire application
 */

/* Tailwind CSS */
@import 'tailwindcss';

/* local styles - update the below if you add a new style */
@import './theme.css';
@import './theme.utilities.css';
@import './shadcn-ui.css';
@import './markdoc.css';
@import './qwery.css';

/* plugins - update the below if you add a new plugin */
@plugin "tailwindcss-animate";

/* content sources - update the below if you add a new path */
@source "../../../packages/*/src/**/*.{ts,tsx}";
@source "../../../packages/features/*/src/**/*.{ts,tsx}";
@source "../{app,components,config,lib}/**/*.{ts,tsx}";

/* variants - update the below if you add a new variant */
@variant dark (&:where(.dark, .dark *));

@layer base {
  body {
    @apply bg-background text-foreground;
    font-feature-settings: "rlig" 1, "calt" 1;
  }

  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--border, currentColor);
  }

  input::placeholder,
  textarea::placeholder {
    color: theme(--color-muted-foreground);
  }
}

/* VS Code-style Scrollbar */
@layer utilities {
  /* Custom scrollbar for main content areas */
  .vscode-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.1) transparent;
  }

  .vscode-scrollbar::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }

  .vscode-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .vscode-scrollbar::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 5px;
    border: 2px solid transparent;
    background-clip: padding-box;
    transition: background-color 0.2s ease;
  }

  .vscode-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: rgba(255, 255, 255, 0.2);
  }

  .vscode-scrollbar::-webkit-scrollbar-thumb:active {
    background-color: rgba(255, 255, 255, 0.3);
  }

  .vscode-scrollbar::-webkit-scrollbar-corner {
    background: transparent;
  }

  /* Dark mode scrollbar (more visible) */
  .dark .vscode-scrollbar {
    scrollbar-color: rgba(255, 255, 255, 0.15) transparent;
  }

  .dark .vscode-scrollbar::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.15);
  }

  .dark .vscode-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: rgba(255, 255, 255, 0.25);
  }

  .dark .vscode-scrollbar::-webkit-scrollbar-thumb:active {
    background-color: rgba(255, 255, 255, 0.35);
  }

  /* Apply VS Code-style scrollbar to main scrollable content areas */
  /* Thin, subtle scrollbar that appears on hover - VS Code style */
  body:has([data-desktop-title-bar]) div[class*="overflow-y-auto"],
  body:has([data-desktop-title-bar]) div[class*="overflow-auto"] {
    scrollbar-width: thin;
    scrollbar-color: rgba(128, 128, 128, 0.4) transparent;
  }

  body:has([data-desktop-title-bar]) div[class*="overflow-y-auto"]::-webkit-scrollbar,
  body:has([data-desktop-title-bar]) div[class*="overflow-auto"]::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }

  body:has([data-desktop-title-bar]) div[class*="overflow-y-auto"]::-webkit-scrollbar-track,
  body:has([data-desktop-title-bar]) div[class*="overflow-auto"]::-webkit-scrollbar-track {
    background: transparent;
  }

  body:has([data-desktop-title-bar]) div[class*="overflow-y-auto"]::-webkit-scrollbar-thumb,
  body:has([data-desktop-title-bar]) div[class*="overflow-auto"]::-webkit-scrollbar-thumb {
    background-color: rgba(128, 128, 128, 0.4);
    border-radius: 5px;
    border: 2px solid transparent;
    background-clip: padding-box;
    transition: background-color 0.15s ease;
  }

  body:has([data-desktop-title-bar]) div[class*="overflow-y-auto"]::-webkit-scrollbar-thumb:hover,
  body:has([data-desktop-title-bar]) div[class*="overflow-auto"]::-webkit-scrollbar-thumb:hover {
    background-color: rgba(128, 128, 128, 0.6);
  }

  body:has([data-desktop-title-bar]) div[class*="overflow-y-auto"]::-webkit-scrollbar-thumb:active,
  body:has([data-desktop-title-bar]) div[class*="overflow-auto"]::-webkit-scrollbar-thumb:active {
    background-color: rgba(128, 128, 128, 0.8);
  }

  body:has([data-desktop-title-bar]) div[class*="overflow-y-auto"]::-webkit-scrollbar-corner,
  body:has([data-desktop-title-bar]) div[class*="overflow-auto"]::-webkit-scrollbar-corner {
    background: transparent;
  }

  /* Dark mode scrollbar - slightly more visible */
  body:has([data-desktop-title-bar]).dark div[class*="overflow-y-auto"],
  body:has([data-desktop-title-bar]).dark div[class*="overflow-auto"] {
    scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
  }

  body:has([data-desktop-title-bar]).dark div[class*="overflow-y-auto"]::-webkit-scrollbar-thumb,
  body:has([data-desktop-title-bar]).dark div[class*="overflow-auto"]::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.2);
  }

  body:has([data-desktop-title-bar]).dark div[class*="overflow-y-auto"]::-webkit-scrollbar-thumb:hover,
  body:has([data-desktop-title-bar]).dark div[class*="overflow-auto"]::-webkit-scrollbar-thumb:hover {
    background-color: rgba(255, 255, 255, 0.3);
  }

  body:has([data-desktop-title-bar]).dark div[class*="overflow-y-auto"]::-webkit-scrollbar-thumb:active,
  body:has([data-desktop-title-bar]).dark div[class*="overflow-auto"]::-webkit-scrollbar-thumb:active {
    background-color: rgba(255, 255, 255, 0.4);
  }
}

/* Desktop Title Bar Styles */
@layer utilities {
  .drag-region {
    -webkit-app-region: drag;
    user-select: none;
  }

  .no-drag-region {
    -webkit-app-region: no-drag;
  }

  /* Remove body padding - we'll use margin-top on Page container instead */
  /* body:has([data-desktop-title-bar]) {
    padding-top: 2.5rem;
  } */

  /* Ensure title bar dropdowns appear above content */
  [data-desktop-title-bar] [class*="absolute"] {
    z-index: 9999;
  }

  /* Prevent sidebar scrolling in desktop app - comprehensive fix */
  body:has([data-desktop-title-bar]) [data-sidebar="sidebar"] {
    overflow: hidden !important;
    max-height: calc(100vh - 2.5rem) !important; /* Viewport height minus title bar */
    -ms-overflow-style: none !important;
    scrollbar-width: none !important;
  }

  body:has([data-desktop-title-bar]) [data-sidebar="sidebar"] > * {
    overflow: hidden !important;
    -ms-overflow-style: none !important;
    scrollbar-width: none !important;
  }

  /* Target SidebarContent specifically (has overflow-auto class) */
  body:has([data-desktop-title-bar]) [data-sidebar="content"] {
    overflow: hidden !important;
    -ms-overflow-style: none !important;
    scrollbar-width: none !important;
    max-height: 100% !important;
    flex-shrink: 1 !important;
    min-height: 0 !important;
  }

  /* Ensure sidebar flex container doesn't allow overflow */
  body:has([data-desktop-title-bar]) [data-sidebar="sidebar"][class*="flex-col"] {
    overflow: hidden !important;
    height: 100% !important;
  }

  /* Hide all scrollbars in sidebar and its children */
  body:has([data-desktop-title-bar]) [data-sidebar="sidebar"]::-webkit-scrollbar,
  body:has([data-desktop-title-bar]) [data-sidebar="sidebar"] *::-webkit-scrollbar,
  body:has([data-desktop-title-bar]) [data-sidebar="content"]::-webkit-scrollbar {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
  }

  body:has([data-desktop-title-bar]) [data-sidebar="sidebar"] * {
    -ms-overflow-style: none !important;
    scrollbar-width: none !important;
  }

  /* Hide default web app top bar in desktop mode (desktop title bar replaces it) */
  body:has([data-desktop-title-bar]) [class*="sticky top-0 z-[100]"] {
    display: none !important;
  }

  /* Adjust sidebar position to account for desktop title bar (40px) instead of top bar (56px) */
  body:has([data-desktop-title-bar]) [data-sidebar="sidebar"] {
    top: 2.5rem !important; /* 40px for title bar */
  }

  /* Adjust the sidebar container div position - change from top-14 (56px) to top-10 (40px) */
  body:has([data-desktop-title-bar]) div[class*="fixed"][class*="top-14"] {
    top: 2.5rem !important; /* 40px = 2.5rem for title bar */
  }

  /* Adjust main Page container height to account for desktop title bar */
  /* Title bar is fixed (overlays), so content area should be viewport minus title bar */
  body:has([data-desktop-title-bar]) div[class*="h-screen"][class*="flex-col"] {
    height: calc(100vh - 2.5rem) !important; /* Viewport height minus title bar (40px) */
    margin-top: 2.5rem !important; /* Push content down below fixed title bar */
  }

  /* Adjust the content area to fill remaining space */
  body:has([data-desktop-title-bar]) div[class*="min-h-0"][class*="flex-1"][class*="overflow-hidden"] {
    height: calc(100vh - 2.5rem) !important; /* Full height minus title bar */
    max-height: calc(100vh - 2.5rem) !important;
  }

  /* Ensure scrollable content area doesn't exceed viewport */
  body:has([data-desktop-title-bar]) div[class*="flex-1"][class*="overflow-y-auto"] {
    max-height: calc(100vh - 2.5rem) !important; /* Prevent page-level scroll */
  }

  /* Hide web app footer in desktop mode */
  body:has([data-desktop-title-bar]) div[class*="shrink-0"]:has(div[class*="bg-sidebar"][class*="border-t"]),
  body:has([data-desktop-title-bar]) div[class*="bg-sidebar"][class*="border-t"][class*="h-12"],
  body:has([data-desktop-title-bar]) div[class*="bg-sidebar"][class*="flex"][class*="h-12"][class*="border-t"] {
    display: none !important;
  }

  /* Alternative: Position top bar below desktop title bar instead of hiding */
  /* body:has([data-desktop-title-bar]) [class*="sticky top-0 z-[100]"] {
    top: 2.5rem !important;
  } */
}